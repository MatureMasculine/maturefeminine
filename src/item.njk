---
layout: layout.njk
pagination:
  data: collections.items
  size: 1
  alias: item
permalink: "/{{ item.groupSlug }}/{{ item.slug }}/index.html"
---

<a class="small" href="{{ item.groupSlug }}/">← Back to {{ item.groupName }}</a>
<h1 class="mt-2">{{ item.name }}</h1>
{% if item.gifts %}<p class="mf-subtle mb-3">{{ item.gifts }}</p>{% endif %}
{% set img = images[item.slug] %}
{% if img %}
<figure class="my-3">
  <img class="img-fluid rounded" src="{{ ("/assets/images/" ~ img) | url }}" alt="{{ item.name }} illustration" loading="lazy">
  <figcaption class="small text-muted mt-1">{{ item.name }}</figcaption>
 </figure>
{% endif %}

<p>
  {% if item.qualities and false %}
    {% for q in item.qualities %}
      <span class="badge text-bg-primary chip">{{ q }}</span>
    {% endfor %}
  {% endif %}
</p>

{# Gifts moved under the title as a subtitle #}

{# Legacy shadowFaces removed: migrated to extended.shadows #}

  {% if item.extended.balance %}
  <div class="mf-box section-yellow mb-3">
    <h4 class="mb-2"><i class="fas fa-scale-balanced me-2"></i>Balance & Qualities</h4>
    <div class="row g-2 small">
      <div class="col-12 col-md-6">
        <p class="mb-1"><strong>Balance:</strong> {{ item.extended.balance.balance | fixEncoding }}</p>
        <p class="mb-0"><strong>Shadow:</strong> {{ item.extended.balance.shadow | fixEncoding }}</p>
      </div>
      <div class="col-12 col-md-6">
        {% if item.extended.balance.powerAnimals %}<p class="mb-1"><strong>Power Animals:</strong> {{ item.extended.balance.powerAnimals | fixEncoding }}</p>{% endif %}
        {% if item.extended.balance.qualities %}<p class="mb-0"><strong>Qualities:</strong> {{ item.extended.balance.qualities | fixEncoding }}</p>{% endif %}
      </div>
    </div>
    {% if item.growthPath or item.practices %}
    <div class="mt-3 mf-divider-top">
      {% if item.growthPath %}
      <h6 class="mb-1"><i class="fas fa-seedling me-2"></i>Growth Path</h6>
      <p class="mb-2">{{ item.growthPath | fixEncoding }}</p>
      {% endif %}
      {% if item.practices %}
      <h6 class="mb-1"><i class="fas fa-spa me-2"></i>Practices</h6>
      {% if item.practices | safe and item.practices.push %}
        <ul class="mb-0">
          {% for p in item.practices %}<li>{{ p | fixEncoding }}</li>{% endfor %}
        </ul>
      {% else %}
        <p class="mb-0">{{ item.practices | fixEncoding }}</p>
      {% endif %}
      {% endif %}
    </div>
    {% endif %}
  </div>
  {% endif %}

{% if item.growthPath and not (item.extended and item.extended.balance) %}
<div class="mb-3">
  <h5>Growth path</h5>
  <p class="mb-0">{{ item.growthPath | fixEncoding }}</p>
</div>
{% endif %}

{% if item.practices and not (item.extended and item.extended.balance) %}
<div class="mb-3">
  <h5>Practices</h5>
  {% if item.practices | safe and item.practices.push %}
    <ul>
      {% for p in item.practices %}<li>{{ p | fixEncoding }}</li>{% endfor %}
    </ul>
  {% else %}
    <p>{{ item.practices | fixEncoding }}</p>
  {% endif %}
</div>
{% endif %}

{% if item.extended %}
  {# Styled sections matching sample.html #}
  {% if item.extended.mature %}
  <div class="mf-box section-green mb-3">
    <h4 class="mb-2"><i class="fas fa-crown me-2"></i>{{ item.extended.mature.title or 'Mature' }}</h4>
    {% if item.extended.mature.paragraphs %}
      {% for para in item.extended.mature.paragraphs %}<p class="mb-2">{{ para }}</p>{% endfor %}
    {% endif %}
  </div>
  {% endif %}

  {% if item.extended.virtues %}
  <div class="virtue-card mb-3">
    <h4 class="mb-3"><i class="fas fa-gem me-2"></i>Virtues</h4>
    {% for v in item.extended.virtues %}
      <div class="mb-3">
        <h6 class="mb-2">{{ v.title }}</h6>
        {% if v.quote %}<blockquote class="fst-italic border-start border-2 ps-3" style="border-color: rgba(255,255,255,.5)">{{ v.quote | fixEncoding | stripOuterQuotes }}</blockquote>{% endif %}
        {% if v.paragraphs %}{% for vp in v.paragraphs %}<p class="mb-2">{{ vp }}</p>{% endfor %}{% endif %}
      </div>
    {% endfor %}
  </div>
  {% endif %}


  {% if item.extended.declarations %}
  <div class="mf-box section-blue mb-3">
    <h4 class="mb-2"><i class="fas fa-quote-left me-2"></i>Mature Declarations</h4>
    <ul class="mf-declarations">
      {% for d in item.extended.declarations %}
        <li class="mb-1"><i class="fas fa-circle text-primary fa-2xs me-2"></i>{{ d }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  {% if item.extended.shadows %}
    {% for sh in item.extended.shadows %}
    <div class="shadow-card mb-3">
      <h4 class="mb-2"><i class="fas fa-mask me-2"></i>{{ sh.name }}{% if sh.type %} ({{ sh.type }} shadow){% endif %}</h4>
      {% set shadowSlug = sh.name | slug %}
      {% set shImg = images.shadow and images.shadow[item.slug] and images.shadow[item.slug][shadowSlug] %}
      {% if not shImg and images.extraShadow %}{% set shImg = images.extraShadow[shadowSlug] %}{% endif %}
      {% if shImg %}
      <figure class="my-2">
        <img class="img-fluid rounded" src="{{ ("/assets/images/" ~ shImg) | url }}" alt="{{ sh.name }} illustration" loading="lazy">
        <figcaption class="small text-muted mt-1">{{ sh.name }}</figcaption>
      </figure>
      {% endif %}

      {% if sh.description %}
      <div class="shadow-subcard mb-2">
        <h6 class="mb-1"><i class="fas fa-align-left me-2"></i>Description</h6>
        {% if sh.description.push %}
          {% for para in sh.description %}<p class="mb-2">{{ para }}</p>{% endfor %}
        {% else %}
          <p class="mb-0">{{ sh.description }}</p>
        {% endif %}
      </div>
      {% endif %}

      {% if sh.declarations %}
      <div class="shadow-subcard mb-2">
        <h6 class="mb-1"><i class="fas fa-quote-left me-2"></i>Shadow Declarations</h6>
        <ul class="mb-0 ps-3">
          {% for sd in sh.declarations %}<li>{{ sd }}</li>{% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if sh.balancing %}
      <div class="shadow-subcard mb-2">
        <h6 class="mb-1"><i class="fas fa-scale-balanced me-2"></i>Balancing</h6>
        <ul class="mb-0 ps-3">
          {% for b in sh.balancing %}<li>{{ b }}</li>{% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if sh.gift %}
      <div class="shadow-subcard mb-2">
        <h6 class="mb-1"><i class="fas fa-gift me-2"></i>Gift</h6>
        <p class="mb-0">{{ sh.gift }}</p>
      </div>
      {% endif %}

      {% if sh.outOfBalance %}
      <div class="shadow-subcard mb-2">
        <h6 class="mb-1"><i class="fas fa-triangle-exclamation me-2"></i>Out of Balance</h6>
        {% if sh.outOfBalance.push %}
          <ul class="mb-0 ps-3">{% for ob in sh.outOfBalance %}<li>{{ ob }}</li>{% endfor %}</ul>
        {% else %}
          <p class="mb-0">{{ sh.outOfBalance }}</p>
        {% endif %}
      </div>
      {% endif %}

      {% if sh.qualities %}
      <div class="shadow-subcard mb-0">
        <h6 class="mb-1"><i class="fas fa-star me-2"></i>Qualities</h6>
        <p class="mb-0">{{ sh.qualities }}</p>
      </div>
      {% endif %}
    </div>
    {% endfor %}
  {% endif %}


{% endif %}

{# Legacy shadow fields removed: now using extended.shadows #}

<div class="d-flex justify-content-between mt-4">
  {% set items = collections.items | itemsByGroup(item.groupSlug) %}
  {% set idx = items | findIndexBySlug(item.slug) %}
  {% set prev = items[idx - 1] %}
  {% set next = items[idx + 1] %}
  {# Fallback to global neighbors across groups when at boundaries #}
  {% if not prev or not next %}
    {% set all = collections.items %}
    {% set gidx = all | findIndexBySlug(item.slug) %}
    {% if not prev %}{% set prev = all[gidx - 1] %}{% endif %}
    {% if not next %}{% set next = all[gidx + 1] %}{% endif %}
  {% endif %}
  <div>
  {% if prev %}
    <a class="btn btn-outline-secondary btn-sm" href="{{ prev.groupSlug }}/{{ prev.slug }}/">← {{ prev.name }}</a>
  {% endif %}
  </div>
  <div>
  {% if next %}
    <a class="btn btn-outline-secondary btn-sm" href="{{ next.groupSlug }}/{{ next.slug }}/">{{ next.name }} →</a>
  {% endif %}
  </div>
</div>
