---
layout: layout.njk
pagination:
  data: collections.items
  size: 1
  alias: item
permalink: "/{{ item.groupSlug }}/{{ item.slug }}/index.html"
---

<a class="small" href="{{ item.groupSlug }}/">← Back to {{ item.groupName }}</a>
<h1 class="mt-2">{{ item.name }}</h1>

{% set img = images[item.slug] %}
{% if img %}
<figure class="my-3">
  <img class="img-fluid rounded" src="assets/images/{{ img }}" alt="{{ item.name }} illustration" loading="lazy">
  <figcaption class="small text-muted mt-1">{{ item.name }}</figcaption>
 </figure>
{% endif %}

<p>
  {% if item.qualities %}
    {% for q in item.qualities %}
      <span class="badge text-bg-primary chip">{{ q }}</span>
    {% endfor %}
  {% endif %}
</p>

{% if item.gifts %}
<div class="mb-3">
  <h5>Gifts</h5>
  <p>{{ item.gifts }}</p>
</div>
{% endif %}

{% if item.shadowFaces %}
<div class="mb-3">
  <h5>Shadow faces</h5>
  <ul class="mb-0">
    {% for s in item.shadowFaces %}<li>{{ s }}</li>{% endfor %}
  </ul>
</div>
{% endif %}

{% if item.growthPath %}
<div class="mb-3">
  <h5>Growth path</h5>
  <p class="mb-0">{{ item.growthPath }}</p>
</div>
{% endif %}

{% if item.practices %}
<div class="mb-3">
  <h5>Practices</h5>
  {% if item.practices | safe and item.practices.push %}
    <ul>
      {% for p in item.practices %}<li>{{ p }}</li>{% endfor %}
    </ul>
  {% else %}
    <p>{{ item.practices }}</p>
  {% endif %}
</div>
{% endif %}

{% if item.extended %}
<div class="mb-4">
  <h4>Extended</h4>
  <div class="accordion" id="ext-{{ item.slug }}">
    {% if item.extended.mature %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading-mature-{{ item.slug }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-mature-{{ item.slug }}" aria-expanded="false" aria-controls="collapse-mature-{{ item.slug }}">
          {{ item.extended.mature.title or 'Mature' }}
        </button>
      </h2>
      <div id="collapse-mature-{{ item.slug }}" class="accordion-collapse collapse" data-bs-parent="#ext-{{ item.slug }}">
        <div class="accordion-body">
          {% if item.extended.mature.paragraphs %}
            {% for para in item.extended.mature.paragraphs %}<p>{{ para }}</p>{% endfor %}
          {% endif %}
          {% if item.extended.balance %}
          <div class="mt-3">
            <h6>Balance</h6>
            <p><strong>Balance:</strong> {{ item.extended.balance.balance }}</p>
            <p><strong>Shadow:</strong> {{ item.extended.balance.shadow }}</p>
            {% if item.extended.balance.powerAnimals %}<p><strong>Power Animal:</strong> {{ item.extended.balance.powerAnimals }}</p>{% endif %}
            {% if item.extended.balance.qualities %}<p><strong>Qualities:</strong> {{ item.extended.balance.qualities }}</p>{% endif %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    {% endif %}

    {% if item.extended.declarations %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading-declarations-{{ item.slug }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-declarations-{{ item.slug }}" aria-expanded="false" aria-controls="collapse-declarations-{{ item.slug }}">
          Declarations
        </button>
      </h2>
      <div id="collapse-declarations-{{ item.slug }}" class="accordion-collapse collapse" data-bs-parent="#ext-{{ item.slug }}">
        <div class="accordion-body">
          <ul>
            {% for d in item.extended.declarations %}<li>{{ d }}</li>{% endfor %}
          </ul>
        </div>
      </div>
    </div>
    {% endif %}

    {% if item.extended.shadows %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading-shadows-{{ item.slug }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-shadows-{{ item.slug }}" aria-expanded="false" aria-controls="collapse-shadows-{{ item.slug }}">
          Shadows
        </button>
      </h2>
      <div id="collapse-shadows-{{ item.slug }}" class="accordion-collapse collapse" data-bs-parent="#ext-{{ item.slug }}">
        <div class="accordion-body">
          {% for sh in item.extended.shadows %}
          <div class="mb-4">
            <h6>{{ sh.name }}</h6>
            {% if sh.description %}
              {% for para in sh.description %}<p>{{ para }}</p>{% endfor %}
            {% endif %}
            {% if sh.declarations %}
            <div class="mt-2">
              <strong>Shadow Declarations</strong>
              <ul>{% for sd in sh.declarations %}<li>{{ sd }}</li>{% endfor %}</ul>
            </div>
            {% endif %}
            {% if sh.balancing %}
            <div class="mt-2">
              <strong>Balancing</strong>
              <ul>{% for b in sh.balancing %}<li>{{ b }}</li>{% endfor %}</ul>
            </div>
            {% endif %}
            {% if sh.gift %}
            <div class="mt-2">
              <strong>Gift</strong>
              <p>{{ sh.gift }}</p>
            </div>
            {% endif %}
            {% if sh.outOfBalance %}
            <div class="mt-2">
              <strong>Out of Balance</strong>
              <p>{{ sh.outOfBalance }}</p>
            </div>
            {% endif %}
            {% if sh.qualities %}
            <div class="mt-2">
              <strong>Qualities</strong>
              <p>{{ sh.qualities }}</p>
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}

    {% if item.extended.virtues %}
    <div class="accordion-item">
      <h2 class="accordion-header" id="heading-virtues-{{ item.slug }}">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-virtues-{{ item.slug }}" aria-expanded="false" aria-controls="collapse-virtues-{{ item.slug }}">
          Virtues
        </button>
      </h2>
      <div id="collapse-virtues-{{ item.slug }}" class="accordion-collapse collapse" data-bs-parent="#ext-{{ item.slug }}">
        <div class="accordion-body">
          {% for v in item.extended.virtues %}
          <div class="mb-4">
            <h6>{{ v.title }}</h6>
            {% if v.quote %}<p class="fst-italic">{{ v.quote }}</p>{% endif %}
            {% if v.paragraphs %}{% for vp in v.paragraphs %}<p>{{ vp }}</p>{% endfor %}{% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
    {% endif %}
  </div>
</div>
{% endif %}

{% if item.activeShadow or item.passiveShadow or item.shadows %}
<div class="mb-3">
  <h5>Shadows</h5>
  <ul>
    {% if item.shadows %}
      {% for s in item.shadows %}<li>{{ s }}</li>{% endfor %}
    {% else %}
      {% if item.activeShadow %}<li><strong>Active:</strong> {{ item.activeShadow }}</li>{% endif %}
      {% if item.passiveShadow %}<li><strong>Passive:</strong> {{ item.passiveShadow }}</li>{% endif %}
    {% endif %}
  </ul>
</div>
{% endif %}

<div class="d-flex justify-content-between mt-4">
  {% set items = collections.items | itemsByGroup(item.groupSlug) %}
  {% set idx = items | findIndexBySlug(item.slug) %}
  {% set prev = items[idx - 1] %}
  {% set next = items[idx + 1] %}
  {# Fallback to global neighbors across groups when at boundaries #}
  {% if not prev or not next %}
    {% set all = collections.items %}
    {% set gidx = all | findIndexBySlug(item.slug) %}
    {% if not prev %}{% set prev = all[gidx - 1] %}{% endif %}
    {% if not next %}{% set next = all[gidx + 1] %}{% endif %}
  {% endif %}
  <div>
  {% if prev %}
    <a class="btn btn-outline-secondary btn-sm" href="{{ prev.groupSlug }}/{{ prev.slug }}/">← {{ prev.name }}</a>
  {% endif %}
  </div>
  <div>
  {% if next %}
    <a class="btn btn-outline-secondary btn-sm" href="{{ next.groupSlug }}/{{ next.slug }}/">{{ next.name }} →</a>
  {% endif %}
  </div>
</div>
